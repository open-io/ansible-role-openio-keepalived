---
# tasks file for ansible-role-keepalived
- name: Load OS specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"

- name: Install packages
  package:
    name: "{{ keepalived_packages }}"
    state: present

- name: Allow binding non-local IPs to the hosts
  sysctl:
    name: net.ipv4.ip_nonlocal_bind
    value: 1
    ignoreerrors: yes

- name: Start and enable keepalived
  service:
    name: "{{ keepalived_service_name }}"
    state: started
    enabled: true

- name: Configure keepalived
  template:
    src: keepalived.conf.j2
    dest: "{{ keepalived_conf_path }}"
    owner: root
    group: root
    mode: 0644
  notify: Reload keepalived
...
